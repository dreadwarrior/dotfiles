#!/bin/bash
#
# -*- Mode: sh; coding: utf-8; indent-tabs-mode: nil; tab-width: 2 -*-
# vim:set expandtab tabstop=2 fenc=utf-8 fileformat=unix filetype=sh:
#
# Displays a status bar with battery and cpu info

status() {
  # Battery
  #
  local battery_device=$(upower -e | grep 'BAT')
  local battery_state=$(upower -i $battery_device | grep -E 'state' | sed -n 's/.*\:\s\+\(.*\)$/\1/p')
  local battery_time_to_full=$(upower -i $battery_device | grep -E 'to\ full' | sed -n 's/.*\:\s\+\(.*\)$/\1/p')
  local battery_percentage=$(upower -i $battery_device | grep -E 'percentage' | sed -n 's/.*\:\s\+\(.*\)$/\1/p')

  # CPU
  #
  local cpu_number=$(nproc)
  local cpu_frequency_current=$(lscpu | grep -E 'CPU MHz:' | sed -n 's/.*\:\s\+\(.*\)$/\1/p')
  local cpu_frequency_current_formatted=$(echo "${cpu_frequency_current} 1000" | awk '{printf "%.2f", $1 / $2}')

  printf "Battery: %s (%s) | CPU(s): %d√ó%sGHz\n" $battery_state $battery_percentage $cpu_number $cpu_frequency_current_formatted
}

status "$@"
